{% extends "base.html" %}

{% block content %}
<div class="space-y-6 animate-fade-in-down">
    <!-- Header -->
    <div class="flex items-center justify-between pt-6 pb-2">
        <a href="/" class="text-slate-400 hover:text-white transition-colors flex items-center gap-2">
            <span>ğŸ </span> Volver al Hub
        </a>
        <h2 class="text-xl font-bold text-white">Borradores</h2>
    </div>

    <div class="space-y-4">
        {% if drafts|length == 0 %}
        <div class="text-center py-10">
            <div class="text-4xl mb-4">âœ…</div>
            <p class="text-slate-500">No hay borradores pendientes.</p>
        </div>
        {% endif %}

        {% for d in drafts %}
        <div onclick="window.location.href='/review/{{ d.id }}'"
            class="glass p-4 rounded-xl border border-slate-700 hover:border-yellow-500 cursor-pointer transition-all group">
            <div class="flex justify-between items-center mb-2">
                <span class="text-yellow-500 font-bold text-xs uppercase tracking-wider">Borrador #{{ d.id }}</span>
                <span class="text-slate-500 text-xs">{{ d.date }}</span>
            </div>
            <h3 class="text-lg font-bold text-white group-hover:text-yellow-400 transition-colors">{{ d.provider_name }}
            </h3>
            <div class="flex justify-between mt-2 text-sm text-slate-400 items-end">
                <div>
                    <span>{{ d.lines|length }} Items</span>
                    <span class="font-mono text-white ml-2 block">${{ "%.2f"|format(d.total_amount) }}</span>
                </div>
                <button onclick="event.stopPropagation(); deleteDraft({{ d.id }})"
                    class="text-red-500 hover:text-red-400 p-2 hover:bg-slate-700 rounded-full transition-all">
                    ğŸ—‘
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<script>
    async function deleteDraft(id) {
        if (!confirm("Â¿Eliminar este borrador?")) return;
        try {
            const res = await fetch(`/api/purchases/${id}`, { method: 'DELETE' });
            if (res.ok) {
                window.location.reload();
            } else {
                alert("Error al eliminar");
            }
        } catch (e) { console.error(e); }
    }
</script>
{% endblock %}